
app {
  name = "smartstar"
  version = "1.0.0"
  description = "SmartStar Data Platform"
  organization = "SmartStar Team"
}

# Shared Spark configuration
spark {
  # Application naming
  app-name = ${app.name}"-"${?MODULE_NAME}"-"${environment}

  # Common serialization settings
  serializer = "org.apache.spark.serializer.KryoSerializer"

  kryo {
    buffer = "64k"
    buffer-max = "64m"
    registration-required = false
    # Register common classes used across all modules
    registrator = "com.smartstar.common.serialization.SmartStarKryoRegistrator"
  }

  # Common SQL settings
  sql {
    adaptive {
      enabled = true
      coalesce-partitions = true
      skew-join = true
      local-shuffle-reader = true
    }

    execution {
      arrow {
        pyspark-enabled = true
        max-records-per-batch = 10000
      }
    }

    # Catalog configuration
    catalog {
      spark_catalog {
        type = "hive"
      }
    }
  }

  # Common storage settings
  storage {
    level = "MEMORY_AND_DISK_SER"
    fraction = 0.6
    safe-fraction = 0.9
  }

  # Common network settings
  network {
    timeout = "120s"
    max-retries = 3
    retry-wait = "1s"
  }

  # Common checkpoint configuration
  checkpoint {
    compress = true
    eager = false
  }
}

# Shared database configuration
database {
  driver = "org.postgresql.Driver"
  connection-pool-size = 10
  connection-timeout = "30s"
  idle-timeout = "10m"
  leak-detection-threshold = "60s"
  auto-commit = false
}

# Shared Kafka configuration
kafka {
  group-id-prefix = "smartstar"
  auto-offset-reset = "earliest"
  session-timeout = "30s"
  heartbeat-interval = "3s"
  enable-auto-commit = true
  auto-commit-interval = "1s"

  # Common consumer settings
  consumer {
    fetch-min-bytes = 1024
    fetch-max-wait = "500ms"
    max-partition-fetch-bytes = 1048576
  }

  # Common producer settings
  producer {
    acks = "1"
    retries = 3
    max-in-flight-requests-per-connection = 5
    compression-type = "snappy"
  }
}

# Shared storage configuration
storage {
  formats {
    input = "parquet"
    output = "iceberg"
    intermediate = "parquet"
  }
  compression = "snappy"
  write-mode = "overwrite"

  # Common paths structure
  paths {
    datalake_base_path = "s3://smartstar/datalake/"
  }
}